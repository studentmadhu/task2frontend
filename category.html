<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Category Table</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <h2 class="mt-4">Categories</h2>
    <table class="table table-striped" id="categoryTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Category Name</th>
          <th>Stock</th>
          <th>Date</th>
          <th>View Products</th>
        </tr>
      </thead>
      <tbody id="categoryTableBody">
        <!-- Data will be inserted here dynamically -->
      </tbody>
    </table>
    <div id="paginationButtons"></div>
    <div class="d-flex justify-content-center">
      <button id="product" class="btn btn-primary btn-sm">All Products</button>
    </div>

    <script>
      function renderCategoryTable(data) {
        const categoryTableBody = document.getElementById("categoryTableBody");
        categoryTableBody.innerHTML = "";

        data.forEach((rowData) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${rowData.category_id}</td>
            <td>${rowData.category_name}</td>
            <td>${rowData.stock}</td>
            <td>${new Date(rowData.date_created).toLocaleDateString()}</td>
            <td><button class="btn btn-primary btn-sm" onclick="viewProducts(${
              rowData.category_id
            }, 1)">View Products</button></td>
        `;
          categoryTableBody.appendChild(row);
        });
      }

      function viewProducts(categoryId, page) {
        window.location.href = `/prodcutall.html?categoryId=${categoryId}&page=${page}`;
      }

      function viewProducts(categoryId) {
        window.location.href = `/prodcutall.html?categoryId=${categoryId}&page=1`;
      }

      function renderPaginationButtons(currentPage, totalPages) {
        let buttonsHTML = `
      <div class="d-flex justify-content-center">
        <nav aria-label='Page navigation'>
          <ul class='pagination'>`;

        if (currentPage > 1) {
          buttonsHTML += `<li class='page-item'><button class='page-link btn btn-primary btn-sm' onclick='handlePageClick(${
            currentPage - 1
          })'>Previous</button></li>`;
        }

        for (let i = 1; i <= totalPages; i++) {
          const activeClass = i === currentPage ? "active" : "";
          buttonsHTML += `<li class='page-item ${activeClass}'><button class='page-link btn btn-primary btn-sm' onclick='handlePageClick(${i})'>${i}</button></li>`;
        }

        if (currentPage < totalPages) {
          buttonsHTML += `<li class='page-item'><button class='page-link btn btn-primary btn-sm' onclick='handlePageClick(${
            currentPage + 1
          })'>Next</button></li>`;
        }

        buttonsHTML += "</ul></nav></div>";
        return buttonsHTML;
      }

      function handlePageClick(page) {
        const url=`http://localhost:9000/category?page=${page}`;
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            renderCategoryTable(data.data);
            const paginationButtons =
              document.getElementById("paginationButtons");
            paginationButtons.innerHTML = renderPaginationButtons(
              data.currentPage,
              data.totalPages
            );

            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set("page", page);
            window.history.replaceState(null, null, `?${urlParams.toString()}`);
          })
          .catch((error) => {
            console.error("Error fetching category data:", error);
          });
      }

      handlePageClick(1);
      const button = document.getElementById("product");
        button.addEventListener("click", () => {
            window.location.href = "/prodcutall.html";
        });

    </script>
  </body>
</html>
